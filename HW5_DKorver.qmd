---
title: "ST558 Homework 5"
format: html
editor: visual
---

```{r}
#| echo: false
#| message: true
library(tidyverse)
library(ellipse)
math <- read.table("student-mat.csv",sep=";",header=TRUE)
portuguese <- read.table("student-por.csv",sep=";",header=TRUE)
```

## Task 1: Read in the Data and Modify

We are using data from the [UCI machine learning repository](https://archive.ics.uci.edu/dataset/320/student+performance). The data is about secondary education in two Portuguese schools. First, I used the code they provided with the download to read in the data from a local file source and combine the two data frames.

```{r}

#Using the code given from the download package
d1=read.table("student-mat.csv",sep=";",header=TRUE)
d2=read.table("student-por.csv",sep=";",header=TRUE)

d3=merge(d1,d2,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet"))
print(nrow(d3)) # 382 students

```

Then I read in and combined the data using functions from the `tidyverse`. I used inner_join() on the variables they used in their code.

```{r}

d3=inner_join(d1,d2,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet"))

```

I then used an inner_join() on all variables other than G1, G2, G3, paid, and absences. I used this dataframe of the combined data in further exercises.

```{r}

#G1, G2, G3, paid, absences
d1_selected <- d1 %>% select(-G1, -G2, -G3, -paid, -absences)
d2_selected <- d2 %>% select(-G1, -G2, -G3, -paid, -absences)
d3_selected=inner_join(d1_selected,d2_selected,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet"))

```

I then converted four categorical variables into factors: Medu (mother's education), Fedu (father's education), sex, and famsize (family size).

```{r}

d3_selected <- d3_selected |>
  mutate(SexF = factor(sex, levels = c("F", "M"), labels = c("Female", "Male")),
         MeduF = as.factor(Medu),
         FeduF = as.factor(Fedu),
         famsizeF = as.factor(famsize))

math <- math |>
  mutate(SexF = factor(sex, levels = c("F", "M"), labels = c("Female", "Male")),
         MeduF = as.factor(Medu),
         FeduF = as.factor(Fedu),
         famsizeF = as.factor(famsize))

portuguese <- portuguese |>
  mutate(SexF = factor(sex, levels = c("F", "M"), labels = c("Female", "Male")),
         MeduF = as.factor(Medu),
         FeduF = as.factor(Fedu),
         famsizeF = as.factor(famsize))

```

## Task 2: Summarize the Data (Very basic EDA)

I then looked at how the data is stored and looking at missing values.The documentation says there are no missing values in the data.

```{r}

class(d3_selected)
typeof(d3_selected)

sum_na <- function(column){
  sum(is.na(column))
}

na_counts <- d3_selected |>
  summarize(across(everything(), sum_na))
na_counts

```

### Categorical variables

```{r}

#one way
table(d3_selected$sex)
#two way
table(d3_selected$sex,d3_selected$famsize)
#three way
table(d3_selected$sex,d3_selected$famsize,d3_selected$famsize)

```

### Numeric variables

The numeric variables are age, absences, and the three test grades variables (G1, G2, and G3) from each
data set (math and Portuguese).  Lets first take a look at the measures of center and spread for the numeric variables from the math and Portuguese data.

```{r}

math_stats <- math |>
  select(age,absences,G1,G2,G3) |>
  summarize(across(where(is.numeric), 
                   list("mean" = ~ mean(.x, na.rm = TRUE), 
                        "median" = ~ median(.x, na.rm = TRUE),
                        "sd" = ~sd(.x, na.rm = TRUE),
                        "iqr" = ~IQR(.x, na.rm = TRUE)), 
                   .names = "{.fn}_{.col}"))

math_stats

portuguese_stats <- portuguese |>
  select(age,absences,G1,G2,G3) |>
  summarize(across(where(is.numeric), 
                   list("mean" = ~ mean(.x, na.rm = TRUE), 
                        "median" = ~ median(.x, na.rm = TRUE),
                        "sd" = ~sd(.x, na.rm = TRUE),
                        "iqr" = ~IQR(.x, na.rm = TRUE)), 
                   .names = "{.fn}_{.col}"))

portuguese_stats

```

I then looked at the measures of center and spread for the numeric variables from the math and Portuguese data grouped by sex and then grouped by sex and studytime.

```{r}

math_stats_by_sex <- math |>
  select(sex,age,absences,G1,G2,G3) |>
  group_by(sex) |>
  summarize(across(where(is.numeric), 
                   list("mean" = ~ mean(.x, na.rm = TRUE), 
                        "median" = ~ median(.x, na.rm = TRUE),
                        "sd" = ~sd(.x, na.rm = TRUE),
                        "iqr" = ~IQR(.x, na.rm = TRUE)), 
                   .names = "{.fn}_{.col}"))

math_stats_by_sex

math_stats_by_sex_study <- math |>
  select(sex,age,absences,G1,G2,G3,studytime) |>
  group_by(sex,studytime) |>
  summarize(across(where(is.numeric), 
                   list("mean" = ~ mean(.x, na.rm = TRUE), 
                        "median" = ~ median(.x, na.rm = TRUE),
                        "sd" = ~sd(.x, na.rm = TRUE),
                        "iqr" = ~IQR(.x, na.rm = TRUE)), 
                   .names = "{.fn}_{.col}"))

math_stats_by_sex_study

portuguese_stats_by_sex <- portuguese |>
  select(sex,age,absences,G1,G2,G3) |>
  group_by(sex) |>
  summarize(across(where(is.numeric), 
                   list("mean" = ~ mean(.x, na.rm = TRUE), 
                        "median" = ~ median(.x, na.rm = TRUE),
                        "sd" = ~sd(.x, na.rm = TRUE),
                        "iqr" = ~IQR(.x, na.rm = TRUE)), 
                   .names = "{.fn}_{.col}"))

portuguese_stats_by_sex

portuguese_stats_by_sex_study <- portuguese |>
  select(sex,age,absences,G1,G2,G3,studytime) |>
  group_by(sex,studytime) |>
  summarize(across(where(is.numeric), 
                   list("mean" = ~ mean(.x, na.rm = TRUE), 
                        "median" = ~ median(.x, na.rm = TRUE),
                        "sd" = ~sd(.x, na.rm = TRUE),
                        "iqr" = ~IQR(.x, na.rm = TRUE)), 
                   .names = "{.fn}_{.col}"))

portuguese_stats_by_sex_study

```

I then looked at the correlation matrix for both datasets of the numeric variables.

```{r}

ctab_math <- math |>
  select(age,absences,G1,G2,G3) |>
  cor()
as_tibble(ctab_math)

ctab_portuguese <- portuguese |>
  select(age,absences,G1,G2,G3) |>
  cor()
as_tibble(ctab_math)

```

I then created a histogram, kernel density plot, and boxplot for both datasets.
```{r}

ggplot(math, aes(x=age, fill=sex)) +
  geom_histogram(binwidth=.5, alpha=.5, position="dodge")

ggplot(math, aes(x=age, colour=sex)) + geom_density()

ggplot(math, aes(x=G3, y=absences, fill=sex)) + geom_boxplot()

ggplot(portuguese, aes(x=age, fill=sex)) +
  geom_histogram(binwidth=.5, alpha=.5, position="dodge")

ggplot(portuguese, aes(x=age, colour=sex)) + geom_density()

ggplot(portuguese, aes(x=G3, y=absences, fill=sex)) + geom_boxplot()

```

I then created two scatterplots relating the G3 with absences by sex.

```{r}

ggplot(math, aes(x=absences, y=G3, colour = sex)) +
  geom_point(shape=1,position=position_jitter(width=1,height=.5))

ggplot(portuguese, aes(x=absences, y=G3, colour = sex)) +
  geom_point(shape=1,position=position_jitter(width=1,height=.5))

```
